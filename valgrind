#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main() {
    const char* program_to_test = "./hsh";
	FILE* valgrind_output;
    const char* valgrind_command = "valgrind --leak-check=full --show-leak-kinds=all --log-file=valgrind_output.txt";
    char full_command[100], line[1024];
    int result;

    snprintf(full_command, sizeof(full_command), "%s %s -n", valgrind_command, program_to_test);
    result = system(full_command);

    if (result != 0) {
        printf("Error running Valgrind\n");
        return 1;
    }

    valgrind_output = fopen("valgrind_output.txt", "r");
    if (valgrind_output == NULL) {
        printf("Error opening Valgrind output file\n");
        return 1;
    }

    while (fgets(line, sizeof(line), valgrind_output)) {
        if (strstr(line, "definitely lost: 0 bytes") == NULL) {
            printf("Memory leak detected:\n%s", line);
        }
    }

    fclose(valgrind_output);

    return 0;
}
